"""Linting script using Ruff, mypy, and Pylint.

This script runs static analysis tools on the codebase, reading configuration
from pyproject.toml.
"""

from __future__ import annotations

import subprocess
import sys
from pathlib import Path

from scripts.quality.config import load_config


def run_command(cmd: list[str], description: str) -> bool:
    """Run a shell command and return success status.

    Args:
        cmd: Command and arguments to run
        description: Description of what the command does

    Returns:
        True if command succeeded (exit code 0), False otherwise
    """
    print(f"▶ {description}...")
    print(f"  Running: {' '.join(cmd)}")
    result = subprocess.run(cmd, cwd=Path.cwd())
    if result.returncode == 0:
        print(f"✅ {description} - PASSED")
        return True
    print(f"❌ {description} - FAILED")
    return False


def lint_code() -> int:
    """Run linting checks using Ruff, mypy, and Pylint.

    Returns:
        Exit code (0 for success, 1 for failure)
    """
    config = load_config()
    paths = config.code_paths

    print("\n" + "=" * 70)
    print("CODE LINTING")
    print("=" * 70)
    print(f"Paths: {', '.join(paths)}")
    print("=" * 70 + "\n")

    success = True

    # Run Ruff
    ruff_cmd = ["ruff", "check"] + paths
    if not run_command(ruff_cmd, "Ruff (fast Python linter)"):
        success = False

    # Run mypy
    mypy_cmd = ["mypy"] + paths
    if not run_command(mypy_cmd, "mypy (type checking)"):
        success = False

    # Run Pylint
    pylint_cmd = ["pylint"] + paths
    if not run_command(pylint_cmd, "Pylint (code analysis)"):
        success = False

    print("\n" + "=" * 70)
    if success:
        print("✅ ALL LINTING CHECKS PASSED")
    else:
        print("❌ SOME LINTING CHECKS FAILED")
    print("=" * 70 + "\n")

    return 0 if success else 1


def main() -> int:
    """Entry point for the lint script.

    Returns:
        Exit code (0 for success, 1 for failure)
    """
    return lint_code()


if __name__ == "__main__":
    sys.exit(main())
